<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Return & Replacement - DripLine</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="return.css" />
</head>
<body>

  <header class="header">
    <div class="container header__row">

      <a class="brand" href="index.html" aria-label="DripLine Home">
        <img src="dripline.jpg" alt="DripLine" class="brand__logo" />
        <span class="brand__name">DRIPLINE</span>
      </a>

      <div class="search">
        <input class="search__input" type="text" placeholder="Search" aria-label="Search" />
      </div>

      <div class="header__right">
        <div class="promoTag" title="Get 5% OFF on Page">
          Get <strong>5% OFF</strong> on <span>Page</span>
        </div>

        <div class="header__icons">
          <a class="iconBtn" href="store.html" aria-label="Stores" title="Stores">
            <span class="uiIcon" aria-hidden="true">
              <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s7-4.5 7-11a7 7 0 1 0-14 0c0 6.5 7 11 7 11Z" stroke="currentColor" stroke-width="2" />
                <path d="M12 11.5a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z" stroke="currentColor" stroke-width="2" />
              </svg>
            </span>
            <span class="iconBtn__label">Stores</span>
          </a>

          <a class="iconBtn" href="review.html" aria-label="Reviews" title="Reviews">
            <span class="uiIcon" aria-hidden="true">
              <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 3l2.6 5.3 5.9.9-4.3 4.2 1 5.9-5.2-2.8-5.2 2.8 1-5.9-4.3-4.2 5.9-.9L12 3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              </svg>
            </span>
            <span class="iconBtn__label">Reviews</span>
          </a>
<a class="iconBtn" href="return.html" aria-label="Return & Replacement" title="Return & Replacement">
  <span class="uiIcon" aria-hidden="true">
    <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <path d="M7 7h10a3 3 0 0 1 3 3v7a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3v-7a3 3 0 0 1 3-3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
      <path d="M8 7a4 4 0 0 1 8 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M10 13h4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
      <path d="M10.5 16.5l-2-2 2-2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M13.5 12.5l2 2-2 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    </svg>
  </span>
  <span class="iconBtn__label">Return</span>
</a>
          <div class="profileWrap">
            <button class="iconBtn iconBtn--btn profileBtn" type="button" aria-label="Profile" title="Profile" aria-haspopup="menu" aria-expanded="false">
              <span class="uiIcon" aria-hidden="true">
                <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M20 21a8 8 0 0 0-16 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  <path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="2"/>
                </svg>
              </span>
              <span class="iconBtn__label">Profile</span>
            </button>

            <div class="profileDropdown" role="menu" aria-label="Profile menu">
              <div class="profileDropdown__head">Welcome</div>
              <div class="profileDropdown__auth">
                <a href="signin.html" class="profileDropdown__link profileDropdown__link--primary">Sign in</a>
                <span class="profileDropdown__sep">/</span>
                <a href="signup.html" class="profileDropdown__link">Sign up</a>
              </div>

              <div class="profileDropdown__list">
                <a href="#" class="profileDropdown__item" role="menuitem">
                  <svg class="ddIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M7 3h10v4H7V3Z" stroke="currentColor" stroke-width="2"/>
                    <path d="M6 7h12l-1 14H7L6 7Z" stroke="currentColor" stroke-width="2"/>
                    <path d="M9 11h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                  </svg>
                  <span>Track Order</span>
                </a>
                <a href="about.html" class="profileDropdown__item" role="menuitem">
                  <svg class="ddIcon" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                    <path d="M12 22s8-4 8-10V6l-8-4-8 4v6c0 6 8 10 8 10Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                    <path d="M12 11v4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M12 8.25h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                  </svg>
                  <span>About Us</span>
                </a>
              </div>
            </div>
          </div>

          <a class="iconBtn" href="wishlist.html" aria-label="Wishlist" title="Wishlist">
            <span class="uiIcon" aria-hidden="true">
              <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M12 21s-7-4.35-9.2-8.4C1 9.2 3.2 6.5 6.2 6.5c1.6 0 3.1.8 3.8 2 0.7-1.2 2.2-2 3.8-2 3 0 5.2 2.7 3.4 6.1C19 16.65 12 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
              </svg>
            </span>
            <span class="iconBtn__label">Wishlist</span>
          </a>

          <a class="iconBtn" href="bag.html" aria-label="Bag" title="Bag">
            <span class="uiIcon" aria-hidden="true">
              <svg class="iconSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                <path d="M6 7h12l1 14H5L6 7Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                <path d="M9 7a3 3 0 0 1 6 0" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </span>
            <span class="iconBtn__label">Bag</span>
          </a>
        </div>

        <button class="menuBtn" id="menuBtn" aria-label="Open menu" aria-expanded="false">☰</button>
      </div>

    </div>

    <div class="mobileNav" id="mobileNav" hidden>
      <a href="men.html" class="mobileNav__link">MEN</a>
      <a href="marketplace.html" class="mobileNav__link">SHOP NOW</a>
      <a href="jersey.html" class="mobileNav__link">JERSEY</a>
      <a href="essentials.html" class="mobileNav__link">ESSENTIALS</a>
    </div>
  </header>

  <main class="retWrap">
    <div class="container">

      <section class="retShell">
        <div class="retTop">
          <div>
            <div class="retCrumb">
              <a href="index.html">Home</a>
              <span class="retCrumb__sep">›</span>
              <span>Return & Replacement</span>
            </div>
            <h1 class="retTitle">Return / Replacement Request</h1>
            <p class="retSub">Submit your request with product photo. Track status: Pending / Accepted / Declined.</p>
          </div>

          <div class="retPills">
            <div class="retPill">
              <span class="retDot" aria-hidden="true"></span>
              <span><strong id="kpiTotal">0</strong> requests</span>
            </div>
            <div class="retPill retPill--ok">
              <span><strong id="kpiAccepted">0</strong> pending</span>
            </div>
          </div>
        </div>

        <div class="retGrid">

          <section class="retLeft">

            <div class="retCard">
              <div class="retCard__head">
                <div class="retCard__title">Create request</div>
                <div class="retCard__tag">Demo + localStorage</div>
              </div>

              <form class="retForm" id="reqForm" autocomplete="off">
                <div class="retRow2">
                  <label class="retField">
                    <span class="retLabel">Order ID</span>
                    <input class="retInput" id="orderId" type="text" placeholder="e.g., DL-ORD-2026-001" required />
                  </label>

                  <label class="retField">
                    <span class="retLabel">Request Type</span>
                    <select class="retInput" id="reqType" required>
                      <option value="replacement" selected>Replacement</option>
                      <option value="return">Return</option>
                    </select>
                  </label>
                </div>

                <div class="retRow2">
                  <label class="retField">
                    <span class="retLabel">Product (received)</span>
                    <select class="retInput" id="productReceived" required></select>
                  </label>

                  <label class="retField">
                    <span class="retLabel">Reason</span>
                    <select class="retInput" id="reason" required>
                      <option value="" selected disabled>Select reason</option>
                      <option value="size_issue">Size issue</option>
                      <option value="wrong_item">Wrong item received</option>
                      <option value="damaged">Damaged/defective</option>
                      <option value="color_issue">Color not as expected</option>
                      <option value="quality_issue">Quality issue</option>
                      <option value="other">Other</option>
                    </select>
                  </label>
                </div>

                <div class="retRow2 retSwapRow" id="swapRow">
                  <label class="retField">
                    <span class="retLabel">Replacement Product</span>
                    <select class="retInput" id="replacementProduct"></select>
                  </label>

                  <label class="retField">
                    <span class="retLabel">Replacement Variant</span>
                    <select class="retInput" id="replacementVariant"></select>
                  </label>
                </div>

                <div class="retRow2">
                  <label class="retField">
                    <span class="retLabel">Customer Name</span>
                    <input class="retInput" id="custName" type="text" placeholder="Your name" required />
                  </label>

                  <label class="retField">
                    <span class="retLabel">Phone</span>
                    <input class="retInput" id="custPhone" type="tel" placeholder="+8801XXXXXXXXX" required />
                  </label>
                </div>

                <div class="retRow2">
                  <label class="retField">
                    <span class="retLabel">Email (optional)</span>
                    <input class="retInput" id="custEmail" type="email" placeholder="you@example.com" />
                  </label>

                  <label class="retField">
                    <span class="retLabel">Pickup City</span>
                    <input class="retInput" id="city" type="text" placeholder="Dhaka" required />
                  </label>
                </div>

                <label class="retField">
                  <span class="retLabel">Details</span>
                  <textarea class="retArea" id="details" rows="3" placeholder="Write short details (what happened, what you want)..." required></textarea>
                </label>

                <div class="retUpload">
                  <div class="retUpload__left">
                    <div class="retUpload__title">Product photo</div>
                    <div class="retUpload__sub">Upload a clear photo of received product/issue.</div>
                  </div>

                  <div class="retUpload__right">
                    <input class="retFile" id="photo" type="file" accept="image/*" />
                  </div>
                </div>

                <div class="retPreview" id="preview" hidden>
                  <div class="retPreview__imgWrap">
                    <img id="previewImg" class="retPreview__img" alt="Preview" />
                  </div>
                  <button class="retMiniBtn" id="removePhotoBtn" type="button">Remove photo</button>
                </div>

                <div class="retActions">
                  <button class="retBtn retBtn--primary" id="submitBtn" type="button">Submit Request</button>
                  <button class="retBtn" id="demoBtn" type="button">Load Demo</button>
                  <button class="retBtn retBtn--danger" id="resetBtn" type="button">Reset</button>
                </div>
              </form>
            </div>

          </section>

          <aside class="retRight">
            <div class="retCard">
              <div class="retCard__head">
                <div class="retCard__title">My requests</div>
                <div class="retCard__tag">Status tracking</div>
              </div>

              <div class="retTableWrap">
                <div class="retTable">
                  <div class="retTr retTh">
                    <div>Request ID</div>
                    <div>Type</div>
                    <div>Product</div>
                    <div>Status</div>
                  </div>
                  <div id="rows"></div>
                </div>

                <div class="retHint">
                  Data key: <span class="retMono">localStorage["dripline_returns_v1"]</span>
                </div>
              </div>
            </div>

            <div class="retCard">
              <div class="retCard__head">
                <div class="retCard__title">Request details</div>
                <div class="retCard__tag" id="selTag">No selection</div>
              </div>

              <div class="retDetail" id="detailBox">
                <div class="retEmpty">Select a request to view full details.</div>
              </div>
            </div>
          </aside>

        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="container footer__grid">

      <div class="footer__col footer__brandCol">
        <img src="dripline.jpg" alt="" class="footer__mark" />

        <div class="footer__links">
          <a href="about.html">About DripLine</a>
          <a href="terms.html">Terms & Conditions</a>
          <a href="privacy.html">Privacy Policy</a>
          <a href="return-policy.html">Cancellation & Return Policy</a>
          <a href="faqs.html">FAQs</a>
          <a href="contact.html">Contact Us</a>
        </div>
      </div>

      <div class="footer__col footer__mid">
        <div class="footer__help">
          <div class="footer__title">
            <span class="footer__iconTxt">☎</span>
            <span>FOR ANY HELP YOU MAY CALL US AT</span>
          </div>

          <div class="footer__helpText">
            +8801975538778<br />
            Customer Service<br />
            Track your order or get help returning an order
          </div>
        </div>
      </div>

      <div class="footer__col footer__right">
        <div class="footer__follow">
          <div class="footer__title">
            <span class="footer__check">✓</span>
            <span>FOLLOW US</span>
          </div>

          <div class="footer__followText">
            Stay updated on our latest arrivals, exclusive promotions and events.
          </div>

          <div class="socialRow">
            <a class="socialBtn" href="INSTAGRAM_LINK_HERE" target="_blank" rel="noopener" aria-label="Instagram" title="Instagram">
              <span class="socialIcon" aria-hidden="true">
                <svg class="socialSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M12 16a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z" stroke="currentColor" stroke-width="2"/>
                  <path d="M17.5 6.5h.01" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </svg>
              </span>
              <span class="socialBtn__txt">Instagram</span>
            </a>

            <a class="socialBtn" href="https://wa.me/+8801975538778" target="_blank" rel="noopener" aria-label="WhatsApp" title="WhatsApp">
              <span class="socialIcon" aria-hidden="true">
                <svg class="socialSvg" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M20 11.5a8 8 0 0 1-11.9 7L4 20l1.6-4.1A8 8 0 1 1 20 11.5Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M9.2 8.9c.2-.5.5-.5.8-.5h.6c.2 0 .4 0 .5.4l.6 1.4c.1.3 0 .6-.2.8l-.4.4c-.1.1-.2.3-.1.5.4.8 1.3 1.8 2.3 2.3.2.1.4 0 .5-.1l.4-.4c.2-.2.5-.3.8-.2l1.4.6c.4.1.4.3.4.5v.6c0 .3 0 .6-.5.8-.4.2-1.3.4-2.6-.1-1.3-.6-3.1-1.9-4.3-4.1-1.1-2.1-.3-3-.1-3.4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </span>
              <span class="socialBtn__txt">WhatsApp</span>
            </a>
          </div>

          <a class="fbCard" href="https://www.facebook.com/fashionhk7" target="_blank" rel="noopener">
            <div class="fbCard__left">
              <img src="dripline.jpg" alt="Facebook Page" class="fbCard__avatar" />
            </div>

            <div class="fbCard__mid">
              <div class="fbCard__name">DripLine</div>
              <div class="fbCard__meta">Facebook Page</div>

              <div class="fbCard__stats">
                <div class="stat">
                  <div class="stat__num">5.1K</div>
                  <div class="stat__lbl">Followers</div>
                </div>

                <div class="stat stat--divider" aria-hidden="true"></div>

                <div class="stat">
                  <div class="stat__num">1</div>
                  <div class="stat__lbl">Following</div>
                </div>
              </div>
            </div>

            <div class="fbCard__right">
              <div class="fbCard__btn">Follow</div>
            </div>
          </a>

        </div>
      </div>

    </div>

    <div class="footer__bottom">
      <div class="container footer__bottomRow">
        <div>Your order is handled daily with a lot of ❤️ and delivered across Bangladesh!</div>
        <div class="footer__copy">Copyright © DripLine. All Rights Reserved</div>
      </div>
    </div>
  </footer>

  <script>
    (function(){
      const KEY = "dripline_returns_v1";

      const $ = (id) => document.getElementById(id);
      const esc = (s) => String(s ?? "").replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
      const uid = () => "RR-" + Math.random().toString(16).slice(2,6).toUpperCase() + "-" + Date.now().toString().slice(-6);

      const products = [
        { id:"P1", name:"Premium Cotton T-Shirt", img:"collage.jpg", variants:["S / Black","M / Black","L / Black","XL / Black"] },
        { id:"P2", name:"Event Edition Oversized Tee", img:"hero.jpg", variants:["M / White","L / White","XL / White"] },
        { id:"P3", name:"Minimal Logo Hoodie", img:"dripline.jpg", variants:["S / Navy","M / Navy","L / Navy"] }
      ];

      const normalize = (r) => ({
        id: String(r?.id ?? uid()),
        orderId: String(r?.orderId ?? ""),
        type: String(r?.type ?? "replacement"),
        reason: String(r?.reason ?? ""),
        details: String(r?.details ?? ""),
        receivedProductId: String(r?.receivedProductId ?? ""),
        receivedProductName: String(r?.receivedProductName ?? ""),
        receivedVariant: String(r?.receivedVariant ?? ""),
        receivedImg: String(r?.receivedImg ?? ""),
        replaceProductId: String(r?.replaceProductId ?? ""),
        replaceProductName: String(r?.replaceProductName ?? ""),
        replaceVariant: String(r?.replaceVariant ?? ""),
        customerName: String(r?.customerName ?? ""),
        customerPhone: String(r?.customerPhone ?? ""),
        customerEmail: String(r?.customerEmail ?? ""),
        city: String(r?.city ?? ""),
        photoDataUrl: String(r?.photoDataUrl ?? ""),
        status: String(r?.status ?? "pending"),
        adminNote: String(r?.adminNote ?? ""),
        createdAt: Number(r?.createdAt ?? Date.now())
      });

      const read = () => {
        const raw = localStorage.getItem(KEY);
        if (!raw) return [];
        try {
          const arr = JSON.parse(raw);
          if (!Array.isArray(arr)) return [];
          return arr.map(normalize);
        } catch { return []; }
      };

      const write = (arr) => localStorage.setItem(KEY, JSON.stringify(arr));

      const labelReason = (v) => {
        const map = {
          size_issue:"Size issue",
          wrong_item:"Wrong item received",
          damaged:"Damaged/defective",
          color_issue:"Color not as expected",
          quality_issue:"Quality issue",
          other:"Other"
        };
        return map[v] || v || "—";
      };

      const badgeHTML = (status) => {
        const s = String(status || "pending").toLowerCase();
        if (s === "accepted") return `<span class="retBadge retBadge--ok">Accepted</span>`;
        if (s === "declined") return `<span class="retBadge retBadge--off">Declined</span>`;
        return `<span class="retBadge">Pending</span>`;
      };

      let selectedId = "";
      let photoDataUrl = "";

      const rowHTML = (r) => {
        const active = (r.id === selectedId) ? "retTr retRow retRow--active" : "retTr retRow";
        return `
          <div class="${active}" data-id="${esc(r.id)}">
            <div class="retMono retStrong">${esc(r.id)}</div>
            <div class="retStrong">${esc(r.type === "return" ? "Return" : "Replacement")}</div>
            <div class="retWrapTxt">${esc(r.receivedProductName || "—")}</div>
            <div>${badgeHTML(r.status)}</div>
          </div>
        `;
      };

      const detailHTML = (r) => {
        const typeTxt = r.type === "return" ? "Return" : "Replacement";
        const st = String(r.status || "pending").toLowerCase();
        const statusLine = st === "declined"
          ? `<div class="retInfoRow"><span class="retMuted">Decision</span><span class="retStrong">Declined</span></div>
             <div class="retInfoRow"><span class="retMuted">Reason</span><span class="retStrong retDangerTxt">${esc(r.adminNote || "No reason provided")}</span></div>`
          : st === "accepted"
          ? `<div class="retInfoRow"><span class="retMuted">Decision</span><span class="retStrong retOkTxt">Accepted</span></div>`
          : `<div class="retInfoRow"><span class="retMuted">Decision</span><span class="retStrong">Pending</span></div>`;

        const replaceBlock = (r.type === "replacement")
          ? `
            <div class="retDivider"></div>
            <div class="retSecTitle">Replacement selection</div>
            <div class="retInfoRow"><span class="retMuted">Replace with</span><span class="retStrong">${esc(r.replaceProductName || "—")}</span></div>
            <div class="retInfoRow"><span class="retMuted">Variant</span><span class="retStrong">${esc(r.replaceVariant || "—")}</span></div>
          `
          : "";

        const img = r.photoDataUrl || r.receivedImg || "";
        const imgBox = img ? `<img class="retShot" src="${esc(img)}" alt="Product photo" />` : `<div class="retShotPh">No photo</div>`;

        return `
          <div class="retDetailTop">
            <div class="retWho">
              <div class="retAvatar">${esc((r.customerName || "U").slice(0,2).toUpperCase())}</div>
              <div class="retWhoMeta">
                <div class="retName">${esc(r.customerName || "—")}</div>
                <div class="retWhoSub">
                  <span class="retMono">${esc(r.orderId || "—")}</span>
                  <span class="retDotSep">•</span>
                  <span class="retMiniPill">${esc(typeTxt)}</span>
                </div>
              </div>
            </div>
            <div class="retShotWrap">${imgBox}</div>
          </div>

          <div class="retInfo">
            <div class="retInfoRow"><span class="retMuted">Phone</span><span class="retStrong retMono">${esc(r.customerPhone || "—")}</span></div>
            <div class="retInfoRow"><span class="retMuted">Email</span><span class="retStrong">${esc(r.customerEmail || "—")}</span></div>
            <div class="retInfoRow"><span class="retMuted">City</span><span class="retStrong">${esc(r.city || "—")}</span></div>
            <div class="retInfoRow"><span class="retMuted">Created</span><span class="retStrong">${esc(new Date(r.createdAt).toLocaleString())}</span></div>

            <div class="retDivider"></div>
            <div class="retSecTitle">Request</div>
            <div class="retInfoRow"><span class="retMuted">Product</span><span class="retStrong">${esc(r.receivedProductName || "—")}</span></div>
            <div class="retInfoRow"><span class="retMuted">Reason</span><span class="retStrong">${esc(labelReason(r.reason))}</span></div>
            <div class="retInfoRow"><span class="retMuted">Customer note</span><span class="retStrong">${esc(r.details || "—")}</span></div>

            ${replaceBlock}

            <div class="retDivider"></div>
            <div class="retSecTitle">Status</div>
            ${statusLine}
          </div>

          <div class="retDevNote">
            Backend connect করলে admin panel থেকে status update + decline reason বসবে।
          </div>
        `;
      };

      const setKpis = (arr) => {
        $("kpiTotal").textContent = arr.length;
        $("kpiAccepted").textContent = arr.filter(x => String(x.status||"").toLowerCase() === "pending").length;
      };

      const render = () => {
        const arr = read().sort((a,b) => Number(b.createdAt||0) - Number(a.createdAt||0));
        setKpis(arr);
        $("rows").innerHTML = arr.length ? arr.map(rowHTML).join("") : `<div class="retEmptyRow">No requests yet</div>`;

        const sel = arr.find(x => x.id === selectedId);
        if (!sel) {
          $("selTag").textContent = "No selection";
          $("detailBox").innerHTML = `<div class="retEmpty">Select a request to view full details.</div>`;
        } else {
          $("selTag").textContent = sel.id;
          $("detailBox").innerHTML = detailHTML(sel);
        }
      };

      const fillSelects = () => {
        const pr = $("productReceived");
        const rp = $("replacementProduct");
        pr.innerHTML = products.map(p => `<option value="${esc(p.id)}">${esc(p.name)}</option>`).join("");
        rp.innerHTML = products.map(p => `<option value="${esc(p.id)}">${esc(p.name)}</option>`).join("");
      };

      const syncReplacement = () => {
        const type = $("reqType").value;
        $("swapRow").style.display = (type === "replacement") ? "" : "none";

        const rpId = $("replacementProduct").value || products[0].id;
        const p = products.find(x => x.id === rpId) || products[0];
        $("replacementVariant").innerHTML = (p.variants || []).map(v => `<option value="${esc(v)}">${esc(v)}</option>`).join("");
      };

      const readFileAsDataUrl = (file) => new Promise((resolve) => {
        const fr = new FileReader();
        fr.onload = () => resolve(String(fr.result || ""));
        fr.onerror = () => resolve("");
        fr.readAsDataURL(file);
      });

      const clearPhoto = () => {
        photoDataUrl = "";
        $("photo").value = "";
        $("preview").hidden = true;
        $("previewImg").src = "";
      };

      const submit = async () => {
        const form = $("reqForm");
        if (!form.reportValidity()) return;

        const recvId = $("productReceived").value;
        const recvP = products.find(x => x.id === recvId) || products[0];

        const type = $("reqType").value;

        const repId = $("replacementProduct").value;
        const repP = products.find(x => x.id === repId) || products[0];

        const item = normalize({
          id: uid(),
          orderId: $("orderId").value.trim(),
          type,
          reason: $("reason").value,
          details: $("details").value.trim(),
          receivedProductId: recvP.id,
          receivedProductName: recvP.name,
          receivedVariant: "",
          receivedImg: recvP.img,
          replaceProductId: type === "replacement" ? repP.id : "",
          replaceProductName: type === "replacement" ? repP.name : "",
          replaceVariant: type === "replacement" ? $("replacementVariant").value : "",
          customerName: $("custName").value.trim(),
          customerPhone: $("custPhone").value.trim(),
          customerEmail: $("custEmail").value.trim(),
          city: $("city").value.trim(),
          photoDataUrl: photoDataUrl,
          status: "pending",
          adminNote: "",
          createdAt: Date.now()
        });

        const arr = read();
        arr.unshift(item);
        write(arr);

        selectedId = item.id;
        form.reset();
        fillSelects();
        syncReplacement();
        clearPhoto();
        render();
      };

      const seedDemo = () => {
        const now = Date.now();
        const demo = [
          normalize({
            id: "RR-A1B2-" + String(now).slice(-6),
            orderId: "DL-ORD-2026-018",
            type: "replacement",
            reason: "size_issue",
            details: "Size tight, need one size bigger.",
            receivedProductId: "P1",
            receivedProductName: "Premium Cotton T-Shirt",
            receivedImg: "collage.jpg",
            replaceProductId: "P1",
            replaceProductName: "Premium Cotton T-Shirt",
            replaceVariant: "XL / Black",
            customerName: "Sajib Ahmed",
            customerPhone: "+8801975538778",
            customerEmail: "sajib@example.com",
            city: "Dhaka",
            photoDataUrl: "",
            status: "accepted",
            adminNote: "",
            createdAt: now - 2 * 86400000
          }),
          normalize({
            id: "RR-C3D4-" + String(now).slice(-6),
            orderId: "DL-ORD-2026-021",
            type: "return",
            reason: "damaged",
            details: "Product had stitching defect.",
            receivedProductId: "P3",
            receivedProductName: "Minimal Logo Hoodie",
            receivedImg: "dripline.jpg",
            customerName: "Imran Hossain",
            customerPhone: "+8801812340099",
            customerEmail: "imran@example.com",
            city: "Sylhet",
            photoDataUrl: "",
            status: "declined",
            adminNote: "Return window exceeded (7 days).",
            createdAt: now - 5 * 86400000
          })
        ];
        write(demo);
        selectedId = demo[0].id;
        render();
      };

      document.addEventListener("DOMContentLoaded", async () => {
        fillSelects();
        syncReplacement();
        render();

        $("reqType").addEventListener("change", syncReplacement);
        $("replacementProduct").addEventListener("change", syncReplacement);

        $("photo").addEventListener("change", async (e) => {
          const f = e.target.files && e.target.files[0];
          if (!f) return;
          const url = await readFileAsDataUrl(f);
          photoDataUrl = url;
          if (url) {
            $("previewImg").src = url;
            $("preview").hidden = false;
          }
        });

        $("removePhotoBtn").addEventListener("click", clearPhoto);
        $("submitBtn").addEventListener("click", submit);

        $("demoBtn").addEventListener("click", seedDemo);

        $("resetBtn").addEventListener("click", () => {
          localStorage.removeItem(KEY);
          selectedId = "";
          $("reqForm").reset();
          fillSelects();
          syncReplacement();
          clearPhoto();
          render();
        });

        $("rows").addEventListener("click", (e) => {
          const row = e.target.closest("[data-id]");
          if (!row) return;
          selectedId = row.getAttribute("data-id") || "";
          render();
        });
      });
    })();
  </script>

  <script src="main.js"></script>
</body>
</html>
